// productos.js actualizado completo

const urlCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS4jvq-eB9Fn1bZQjdtiboCyn-0sGswn24iWNdJsWqw0MCz0AOhNoId6BKw8ZLFSg/pub?output=csv';

const tipoCambio = 16.33; // Tipo de cambio editable manualmente const pines = { distribuidor: 'PIN-DISTRIBUIDOR-2025', mayorista: 'PIN-MAYORISTA-2025', final: 'PIN-FINAL-2025', licitacion: 'PIN-LICITACION-2025' };

let tipoCliente = ''; let pinCorrecto = false;

function cargarProductos() { Papa.parse(urlCSV, { download: true, header: true, complete: function(results) { const productos = results.data; mostrarSelectorTipoCliente(productos); } }); }

function mostrarSelectorTipoCliente(productos) { const app = document.getElementById('app'); app.innerHTML = <h1>CAT√ÅLOGO OFICIAL MACFORT 2025</h1> <p>Seleccione su tipo de cliente:</p> <div style="display: flex; flex-direction: column; gap: 10px;"> <button onclick="pedirPin('distribuidor')">ü§ù Soy Distribuidor</button> <button onclick="pedirPin('mayorista')">üì¶ Soy Mayorista</button> <button onclick="pedirPin('final')">üõçÔ∏è Soy Cliente Final</button> <button onclick="pedirPin('licitacion')">üìë Licitaci√≥n u Otros</button> </div> <div id="pin-form" style="margin-top: 20px;"></div>; window.pedirPin = (tipo) => { tipoCliente = tipo; document.getElementById('pin-form').innerHTML = <p>Ingrese su PIN de acceso para ${tipo.toUpperCase()}:</p> <input type="password" id="pin" placeholder="PIN autorizado"> <button onclick="verificarPin('${tipo}', ${JSON.stringify(productos)})">Ver cat√°logo</button>; }; }

function verificarPin(tipo, productos) { const pinIngresado = document.getElementById('pin').value; if (pinIngresado === pines[tipo]) { pinCorrecto = true; mostrarProductos(productos); } else { alert('‚ùå PIN incorrecto. Verifique su c√≥digo.'); } }

function mostrarProductos(productos) { const app = document.getElementById('app'); app.innerHTML = <h1>CAT√ÅLOGO OFICIAL MACFORT 2025</h1>;

productos.forEach(prod => { if (!prod["C√≥digo"] || !prod["Precio Base (c/u + IVA)"]) return; const precioBase = parseFloat(prod["Precio Base (c/u + IVA)"]); // asumiendo esta columna const precioBs = (precioBase * tipoCambio).toFixed(2);

const mensajeWsp = encodeURIComponent(`Hola, estoy interesado en el producto:\nProducto: ${prod["Producto"]}\nC√≥digo: ${prod["C√≥digo"]}\nTipo de Cliente: ${tipoCliente.toUpperCase()}\n¬øPodr√≠a facilitarme el PIN autorizado?`);
const enlaceWsp = `https://wa.me/59168099278?text=${mensajeWsp}`;

const contenedor = document.createElement('div');
contenedor.className = 'producto';
contenedor.innerHTML = `
  <div class="info">
    <strong>${prod["Producto"]}</strong><br>
    C√≥digo: ${prod["C√≥digo"]}<br>
    Precio: <span class="precio">Bs ${pinCorrecto ? precioBs : 'üîí Requiere PIN'}</span><br>
    <small class="pin-alerta">${pinCorrecto ? 'Precio oficial v√°lido al tipo de cambio actual' : 'Precio disponible con PIN autorizado'}</small>
  </div>
  <img class="qr" src="https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${prod["C√≥digo"]}%20${prod["Producto"]}" alt="QR">
  <a class="boton-wsp" href="${enlaceWsp}" target="_blank">üì≤ Contactar v√≠a WhatsApp</a>
`;
app.appendChild(contenedor);

}); }

